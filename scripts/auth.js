(function(){const KEY='clinic.auth.role';const DEFAULT_PINS={admin:'4444',doctor:'1111',supervisor:'2222','front-office':'3333'};const norm=r=>{if(!r)return null;r=String(r).toLowerCase().trim();if(r==='frontoffice'||r==='front-office'||r==='front_office')return 'front-office';if(r==='dr'||r==='doc')return 'doctor';return r};function getPins(){try{const ovr=JSON.parse(localStorage.getItem('onesystem.pins')||'null')||{};return Object.assign({},DEFAULT_PINS,ovr)}catch{return DEFAULT_PINS}}function setRole(r){if(r)localStorage.setItem(KEY,norm(r))}function getRole(){return norm(localStorage.getItem(KEY))}function login(pin){const P=getPins();const role=Object.keys(P).find(r=>String(P[r])===String(pin));if(!role)return null;setRole(role);return norm(role)}function logout(){localStorage.removeItem(KEY)}function requireRole(allowed){if(location.pathname.endsWith('/tv.html'))return;const role=getRole();const adminBypass=(role==='admin');let ok;if(!allowed)ok=!!role;else if(Array.isArray(allowed))ok=allowed.map(norm).includes(role);else ok=norm(allowed)===role;if(adminBypass)ok=true;if(!ok)location.href='./unauthorized.html'}window.AUTH={login,logout,getRole,requireRole,getPins};})();