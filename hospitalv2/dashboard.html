
<!doctype html><html lang="en" data-theme="light">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Doctor Dashboard – CSV Demo</title>
<link rel="stylesheet" href="styles.css"/>
<script src="js/csv.js"></script>
</head>
<body>
<div class="wrap">
  <header class="banner"><a class="chip floating-toggle" href="index.html">← Home</a></header>

  <section class="card">
    <h2>Sales Analytics</h2>
    <div class="row">
      <div class="chip">Today: <b id="kToday">0.00</b></div>
      <div class="chip">This Month: <b id="kMTD">0.00</b></div>
      <div class="chip">Invoices Today: <b id="kCnt">0</b></div>
    </div>
  </section>

  <section class="card">
    <h2>Staff (Today) – View only</h2>
    <table id="tbl"></table>
  </section>
</div>
<script>
function fmt(n){return (Number(n)||0).toFixed(2);}
function iso(d){return new Date(d).toISOString().slice(0,10);}
(async function(){
  const inv = CsvDB.all('invoices');
  const day = iso(new Date());
  const todays = inv.filter(i=> (i.invoice_date||'').slice(0,10)===day);
  const mtd = inv.filter(i=> (i.invoice_date||'').slice(0,7)===day.slice(0,7));
  document.getElementById('kToday').textContent=fmt(todays.reduce((s,i)=>s+Number(i.total_rs||0),0));
  document.getElementById('kMTD').textContent=fmt(mtd.reduce((s,i)=>s+Number(i.total_rs||0),0));
  document.getElementById('kCnt').textContent=todays.length;

  const att = CsvDB.all('staff_attendance').filter(a=>a.day===day);
  const rows = [['Name','Role','Status','Note']].concat(att.map(a=>[a.name,a.role,a.status,a.note||'']));
  const html = rows.map((r,i)=>'<tr>'+r.map((c,j)=>`<${i? 'td':'th'}>${c}</${i? 'td':'th'}>`).join('')+'</tr>').join('');
  document.getElementById('tbl').innerHTML=html;
})();
</script>
</body></html>
