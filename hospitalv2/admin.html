<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Staff ‚Äì Admin (CSV)</title>
  <link rel="icon" href="assets/logo.png"/>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    .wrap{max-width:1120px;margin:0 auto}
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 12px}
    .chip{padding:10px 14px;border-radius:999px;background:var(--card-bg);border:1px solid rgba(0,0,0,.06);box-shadow:var(--shadow)}
    .section{background:var(--card-bg);margin:12px;padding:18px;border-radius:var(--radius);box-shadow:var(--shadow)}
    .row{display:grid;gap:16px;grid-template-columns:1fr}
    @media (min-width:960px){.row{grid-template-columns:1fr 1fr}}
    table{width:100%;border-collapse:separate;border-spacing:0}
    th,td{padding:10px;border-bottom:1px solid rgba(0,0,0,.06)}
    th{text-align:left}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
    input,select{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.12)}
  </style>
</head>
<body>
<div class="wrap">
  <header class="banner"><button id="themeToggle" class="chip floating-toggle">üåô</button></header>
  <nav class="toolbar"><a class="chip" href="index.html">‚Üê Home</a></nav>

  <section class="section">
    <h2>Staff ‚Äì Attendance (CSV)</h2>
    <div class="controls">
      <input id="d" type="date"/>
      <select id="status"><option value="">All</option><option>On Duty</option><option>On Leave</option><option>Absent</option></select>
      <input id="q" placeholder="Search name / role"/>
      <button class="chip" id="btnReload">Reload</button>
    </div>
    <div class="row">
      <div>
        <h3 class="muted" style="margin:8px 0">Today‚Äôs Attendance</h3>
        <table><thead><tr><th>Name</th><th>Role</th><th>Status</th><th>Note</th></tr></thead>
          <tbody id="attRows"><tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr></tbody>
        </table>
        <div class="muted mt12">Source: <code>data/staff_attendance.csv</code></div>
      </div>
      <div>
        <h3 class="muted" style="margin:8px 0">Active Roster</h3>
        <table><thead><tr><th>Name</th><th>Role</th><th>Phone</th><th>Active</th></tr></thead>
          <tbody id="staffRows"><tr><td colspan="4" class="muted">Loading‚Ä¶</td></tr></tbody>
        </table>
        <div class="muted mt12">Source: <code>data/staff.csv</code></div>
      </div>
    </div>
  </section>
</div>

<script>
const t=document.getElementById('themeToggle');
if(localStorage.theme){document.documentElement.dataset.theme=localStorage.theme;t.textContent=localStorage.theme==='light'?'üåû':'üåô'}
t.onclick=()=>{const c=document.documentElement.dataset.theme||'light';const n=c==='light'?'dark':'light';document.documentElement.dataset.theme=n;localStorage.theme=n;t.textContent=n==='light'?'üåû':'üåô'}

async function loadCSV(url){const r=await fetch(url,{cache:'no-cache'});const txt=await r.text();return new Promise(res=>Papa.parse(txt,{header:true,skipEmptyLines:true,complete:({data})=>res(data)}));}

let ATT=[], STAFF=[];
function render(){
  // roster
  document.getElementById('staffRows').innerHTML=STAFF.map(s=>`<tr>
    <td>${s.name||''}</td><td>${s.role||''}</td><td>${s.phone||''}</td><td>${String(s.active??'true')}</td>
  </tr>`).join('') || `<tr><td colspan="4" class="muted">No staff</td></tr>`;

  // attendance filtered
  const d=(document.getElementById('d').value||'').slice(0,10);
  const st=(document.getElementById('status').value||'').toLowerCase();
  const q=(document.getElementById('q').value||'').toLowerCase();
  const rows=ATT.filter(a=>{
    const okD=!d || (a.day||a.date||'').slice(0,10)===d;
    const okS=!st || (a.status||'').toLowerCase()===st;
    const okQ=!q || (a.name||'').toLowerCase().includes(q) || (a.role||'').toLowerCase().includes(q);
    return okD && okS && okQ;
  }).map(a=>`<tr><td>${a.name||''}</td><td>${a.role||''}</td><td>${a.status||''}</td><td>${a.note||''}</td></tr>`).join('');
  document.getElementById('attRows').innerHTML=rows||`<tr><td colspan="4" class="muted">No data</td></tr>`;
}

async function reload(){
  [STAFF,ATT]=await Promise.all([loadCSV('data/staff.csv'), loadCSV('data/staff_attendance.csv')]);
  // default date to today if present in CSV
  const today=new Date().toISOString().slice(0,10);
  document.getElementById('d').value=today;
  render();
}
['d','status','q'].forEach(id=>document.getElementById(id).addEventListener('input',render));
document.getElementById('btnReload').onclick=reload;
reload();
</script>
</body>
</html>
